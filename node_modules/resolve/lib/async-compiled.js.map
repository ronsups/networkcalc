{"version":3,"sources":["async.js"],"names":[],"mappings":"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","file":"async-compiled.js","sourcesContent":["var core = require('./core');\nvar fs = require('fs');\nvar path = require('path');\nvar caller = require('./caller.js');\nvar nodeModulesPaths = require('./node-modules-paths.js');\nvar splitRe = process.platform === 'win32' ? /[\\/\\\\]/ : /\\//;\n\nmodule.exports = function resolve (x, opts, cb) {\n    if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n    }\n    if (!opts) opts = {};\n    if (typeof x !== 'string') {\n        return process.nextTick(function () {\n            cb(new Error('path must be a string'));\n        });\n    }\n    \n    var isFile = opts.isFile || function (file, cb) {\n        fs.stat(file, function (err, stat) {\n            if (err && err.code === 'ENOENT') cb(null, false)\n            else if (err) cb(err)\n            else cb(null, stat.isFile() || stat.isFIFO())\n        });\n    };\n    var readFile = opts.readFile || fs.readFile;\n    \n    var extensions = opts.extensions || [ '.js' ];\n    var y = opts.basedir || path.dirname(caller());\n    \n    opts.paths = opts.paths || [];\n    \n    if (/^(?:\\.\\.?(?:\\/|$)|\\/|([A-Za-z]:)?[\\\\\\/])/.test(x)) {\n        var res = path.resolve(y, x);\n        if (x === '..') res += '/';\n        if (/\\/$/.test(x) && res === y) {\n            loadAsDirectory(res, opts.package, onfile);\n        }\n        else loadAsFile(res, opts.package, onfile);\n    }\n    else loadNodeModules(x, y, function (err, n, pkg) {\n        if (err) cb(err)\n        else if (n) cb(null, n, pkg)\n        else if (core[x]) return cb(null, x);\n        else cb(new Error(\"Cannot find module '\" + x + \"' from '\" + y + \"'\"))\n    });\n    \n    function onfile (err, m, pkg) {\n        if (err) cb(err)\n        else if (m) cb(null, m, pkg)\n        else loadAsDirectory(res, function (err, d, pkg) {\n            if (err) cb(err)\n            else if (d) cb(null, d, pkg)\n            else cb(new Error(\"Cannot find module '\" + x + \"' from '\" + y + \"'\"))\n        })\n    }\n    \n    function loadAsFile (x, pkg, cb) {\n        if (typeof pkg === 'function') {\n            cb = pkg;\n            pkg = undefined;\n        }\n        \n        var exts = [''].concat(extensions);\n        load(exts, x, pkg)\n\t\t\n\t\tfunction load (exts, x, pkg) {\n            if (exts.length === 0) return cb(null, undefined, pkg);\n            var file = x + exts[0];\n            \n            if (pkg) onpkg(null, pkg)\n            else loadpkg(path.dirname(file), onpkg);\n            \n            function onpkg (err, pkg_, dir) {\n                pkg = pkg_;\n                if (err) return cb(err)\n                if (dir && pkg && opts.pathFilter) {\n                    var rfile = path.relative(dir, file);\n                    var rel = rfile.slice(0, rfile.length - exts[0].length);\n                    var r = opts.pathFilter(pkg, x, rel);\n                    if (r) return load(\n                        [''].concat(extensions.slice()),\n                        path.resolve(dir, r),\n                        pkg\n                    );\n                }\n                isFile(file, onex);\n            }\n            function onex (err, ex) {\n                if (err) cb(err)\n                else if (!ex) load(exts.slice(1), x, pkg)\n                else cb(null, file, pkg)\n            }\n        }\n    }\n    \n    function loadpkg (dir, cb) {\n        if (dir === '' || dir === '/') return cb(null);\n        if (process.platform === 'win32' && /^\\w:[\\\\\\/]*$/.test(dir)) {\n            return cb(null);\n        }\n        if (/[\\\\\\/]node_modules[\\\\\\/]*$/.test(dir)) return cb(null);\n        \n        var pkgfile = path.join(dir, 'package.json');\n        isFile(pkgfile, function (err, ex) {\n            // on err, ex is false\n            if (!ex) return loadpkg(\n                path.dirname(dir), cb\n            );\n            \n            readFile(pkgfile, function (err, body) {\n                if (err) cb(err);\n                try { var pkg = JSON.parse(body) }\n                catch (err) {}\n                \n                if (pkg && opts.packageFilter) {\n                    pkg = opts.packageFilter(pkg, pkgfile);\n                }\n                cb(null, pkg, dir);\n            });\n        });\n    }\n    \n    function loadAsDirectory (x, fpkg, cb) {\n        if (typeof fpkg === 'function') {\n            cb = fpkg;\n            fpkg = opts.package;\n        }\n        \n        var pkgfile = path.join(x, '/package.json');\n        isFile(pkgfile, function (err, ex) {\n            if (err) return cb(err);\n            if (!ex) return loadAsFile(path.join(x, '/index'), fpkg, cb);\n            \n            readFile(pkgfile, function (err, body) {\n                if (err) return cb(err);\n                try {\n                    var pkg = JSON.parse(body);\n                }\n                catch (err) {}\n                \n                if (opts.packageFilter) {\n                    pkg = opts.packageFilter(pkg, pkgfile);\n                }\n                \n                if (pkg.main) {\n                    if (pkg.main === '.' || pkg.main === './'){\n                        pkg.main = 'index'\n                    }\n                    loadAsFile(path.resolve(x, pkg.main), pkg, function (err, m, pkg) {\n                        if (err) return cb(err);\n                        if (m) return cb(null, m, pkg);\n                        if (!pkg) return loadAsFile(path.join(x, '/index'), pkg, cb);\n\n                        var dir = path.resolve(x, pkg.main);\n                        loadAsDirectory(dir, pkg, function (err, n, pkg) {\n                            if (err) return cb(err);\n                            if (n) return cb(null, n, pkg);\n                            loadAsFile(path.join(x, '/index'), pkg, cb);\n                        });\n                    });\n                    return;\n                }\n                \n                loadAsFile(path.join(x, '/index'), pkg, cb);\n            });\n        });\n    }\n    \n    function loadNodeModules (x, start, cb) {\n        (function process (dirs) {\n            if (dirs.length === 0) return cb(null, undefined);\n            var dir = dirs[0];\n            \n            var file = path.join(dir, '/', x);\n            loadAsFile(file, undefined, onfile);\n            \n            function onfile (err, m, pkg) {\n                if (err) return cb(err);\n                if (m) return cb(null, m, pkg);\n                loadAsDirectory(path.join(dir, '/', x), undefined, ondir);\n            }\n            \n            function ondir (err, n, pkg) {\n                if (err) return cb(err);\n                if (n) return cb(null, n, pkg);\n                process(dirs.slice(1));\n            }\n        })(nodeModulesPaths(start, opts));\n    }\n};\n"]}