{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["var fs = require('fs');\nvar path = require('path');\n\nvar through = require('through2');\nvar Readable = require('readable-stream').Readable;\n\nvar concat = require('concat-stream');\nvar duplexer = require('duplexer2');\nvar falafel = require('falafel');\nvar unparse = require('escodegen').generate;\nvar inspect = require('object-inspect');\nvar evaluate = require('static-eval');\nvar copy = require('shallow-copy');\nvar has = require('has');\n\nmodule.exports = function parse (modules, opts) {\n    if (!opts) opts = {};\n    var vars = opts.vars || {};\n    var varNames = opts.varNames || {};\n    var varModules = opts.varModules || {};\n    var skip = opts.skip || {};\n    var skipOffset = opts.skipOffset || 0;\n    var updates = [];\n    \n    var output = through();\n    var body;\n    return duplexer(concat(function (buf) {\n        try {\n            body = buf.toString('utf8').replace(/^#!/, '//#!');\n            falafel(body, { ecmaVersion: 6 }, walk);\n        }\n        catch (err) { return error(err) }\n        finish(body);\n    }), output);\n    \n    function finish (src) {\n        var pos = 0;\n        src = String(src);\n        \n        (function next () {\n            if (updates.length === 0) return done();\n            var s = updates.shift();\n\n            output.push(src.slice(pos, s.start));\n            pos = s.start + s.offset;\n\n            s.stream.pipe(output, { end: false });\n            s.stream.on('end', next);\n        })();\n        \n        function done () {\n            output.push(src.slice(pos));\n            output.push(null);\n        }\n    }\n    \n    function error (msg) {\n        var err = typeof msg === 'string' ? new Error(msg) : msg;\n        output.emit('error', err);\n    }\n    \n    function walk (node) {\n        var isreq = isRequire(node);\n        var isreqm = false, isreqv = false, reqid;\n        if (isreq) {\n            reqid = node.arguments[0].value;\n            isreqm = has(modules, reqid);\n            isreqv = has(varModules, reqid);\n        }\n        \n        if (isreqv && node.parent.type === 'VariableDeclarator'\n        && node.parent.id.type === 'Identifier') {\n            vars[node.parent.id.name] = varModules[reqid];\n        }\n        else if (isreqv && node.parent.type === 'AssignmentExpression'\n        && node.parent.left.type === 'Identifier') {\n            vars[node.parent.left.name] = varModules[reqid];\n        }\n        else if (isreqv && node.parent.type === 'MemberExpression'\n        && isStaticProperty(node.parent.property)\n        && node.parent.parent.type === 'VariableDeclarator'\n        && node.parent.parent.id.type === 'Identifier') {\n            var v = varModules[reqid][resolveProperty(node.parent.property)];\n            vars[node.parent.parent.id.name] = v;\n        }\n        else if (isreqv && node.parent.type === 'MemberExpression'\n        && node.parent.property.type === 'Identifier') {\n            //vars[node.parent.parent.id.name] = varModules[reqid];\n        }\n        else if (isreqv && node.parent.type === 'CallExpression') {\n            //\n        }\n        \n        if (isreqm && node.parent.type === 'VariableDeclarator'\n        && node.parent.id.type === 'Identifier') {\n            varNames[node.parent.id.name] = reqid;\n            var decs = node.parent.parent.declarations;\n            var ix = decs.indexOf(node.parent);\n            var dec;\n            if (ix >= 0) {\n                dec = decs[ix];\n                decs.splice(ix, 1);\n            }\n            \n            if (decs.length) {\n                var src = unparse(node.parent.parent);\n                updates.push({\n                    start: node.parent.parent.start,\n                    offset: node.parent.parent.end - node.parent.parent.start,\n                    stream: st('var ')\n                });\n                decs.forEach(function (d, i) {\n                    var key = (d.start + skipOffset)\n                        + ',' + (d.end + skipOffset)\n                    ;\n                    skip[key] = true;\n                    \n                    var s = parse(modules, {\n                        skip: skip,\n                        skipOffset: skipOffset + (d.init ? d.init.start : 0),\n                        vars: vars,\n                        varNames: varNames\n                    });\n                    var up = {\n                        start: node.parent.parent.end,\n                        offset: 0,\n                        stream: s\n                    };\n                    updates.push(up);\n                    if (i < decs.length - 1) {\n                        var comma;\n                        if (i === ix - 1) {\n                            comma = body.slice(d.end, dec.start);\n                        }\n                        else comma = body.slice(d.end, decs[i+1].start);\n                        updates.push({\n                            start: node.parent.parent.end,\n                            offset: 0,\n                            stream: st(comma)\n                        });\n                    }\n                    else {\n                        updates.push({\n                            start: node.parent.parent.end,\n                            offset: 0,\n                            stream: st(';')\n                        });\n                    }\n                    s.end(unparse(d));\n                });\n            }\n            else {\n                updates.push({\n                    start: node.parent.parent.start,\n                    offset: node.parent.parent.end - node.parent.parent.start,\n                    stream: st()\n                });\n            }\n        }\n        else if (isreqm && node.parent.type === 'AssignmentExpression'\n        && node.parent.left.type === 'Identifier') {\n            varNames[node.parent.left.name] = reqid;\n            var cur = node.parent.parent;\n            if (cur.type === 'SequenceExpression') {\n                var ex = cur.expressions;\n                var ix = ex.indexOf(node.parent);\n                if (ix >= 0) ex.splice(ix, 1);\n                updates.push({\n                    start: node.parent.parent.start,\n                    offset: node.parent.parent.end - node.parent.parent.start,\n                    stream: st(unparse(node.parent.parent))\n                });\n            }\n            else {\n                updates.push({\n                    start: node.parent.parent.start,\n                    offset: node.parent.parent.end - node.parent.parent.start,\n                    stream: st()\n                });\n            }\n        }\n        else if (isreqm && node.parent.type === 'MemberExpression'\n        && isStaticProperty(node.parent.property)\n        && node.parent.parent.type === 'VariableDeclarator'\n        && node.parent.parent.id.type === 'Identifier') {\n            varNames[node.parent.parent.id.name] = [\n                reqid, resolveProperty(node.parent.property)\n            ];\n            var decNode = node.parent.parent.parent;\n            var decs = decNode.declarations;\n            var ix = decs.indexOf(node.parent.parent);\n            if (ix >= 0) decs.splice(ix, 1);\n            \n            updates.push({\n                start: decNode.start,\n                offset: decNode.end - decNode.start,\n                stream: decs.length ? st(unparse(decNode)) : st()\n            });\n        }\n        else if (isreqm && node.parent.type === 'MemberExpression'\n        && isStaticProperty(node.parent.property)) {\n            var name = resolveProperty(node.parent.property);\n            var cur = copy(node.parent.parent);\n            cur.callee = copy(node.parent.property);\n            cur.callee.parent = cur;\n            traverse(cur.callee, modules[reqid][name]);\n        }\n        else if (isreqm && node.parent.type === 'CallExpression') {\n            var cur = copy(node.parent);\n            var iname = Math.pow(16,8) * Math.random();\n            cur.callee = {\n                type: 'Identifier',\n                name: '_' + Math.floor(iname).toString(16),\n                parent: cur\n            };\n            traverse(cur.callee, modules[reqid]);\n        }\n        \n        if (node.type === 'Identifier' && has(varNames, node.name)) {\n            var vn = varNames[node.name];\n            if (Array.isArray(vn)) {\n                traverse(node, modules[vn[0]][vn[1]]);\n            }\n            else traverse(node, modules[vn]);\n        }\n    }\n    \n    function traverse (node, val) {\n        for (var p = node; p; p = p.parent) {\n            if (p.start === undefined || p.end === undefined) continue;\n            var key = (p.start + skipOffset)\n                + ',' + (p.end + skipOffset)\n            ;\n            if (skip[key]) {\n                skip[key] = false;\n                return;\n            }\n        }\n        \n        if (skip[key]) {\n            skip[key] = false;\n            return;\n        }\n        \n        if (node.parent.type === 'CallExpression') {\n            if (typeof val !== 'function') {\n                return error(\n                    'tried to statically call ' + inspect(val)\n                    + ' as a function'\n                );\n            }\n\n            var xvars = copy(vars);\n            xvars[node.name] = val;\n\n            var res = evaluate(node.parent, xvars);\n            if (res !== undefined) {\n                updates.push({\n                    start: node.parent.start,\n                    offset: node.parent.end - node.parent.start,\n                    stream: isStream(res) ? wrapStream(res) : st(String(res))\n                });\n            }\n        }\n        else if (node.parent.type === 'MemberExpression') {\n            if (!isStaticProperty(node.parent.property)) {\n                return error(\n                    'dynamic property in member expression: '\n                    + node.parent.source()\n                );\n            }\n            \n            var cur = node.parent.parent;\n            \n            if (cur.type === 'MemberExpression') {\n                cur = cur.parent;\n                if (cur.type !== 'CallExpression'\n                && cur.parent.type === 'CallExpression') {\n                    cur = cur.parent;\n                }\n            }\n            if (node.parent.type === 'MemberExpression'\n            && (cur.type !== 'CallExpression'\n            && cur.type !== 'MemberExpression')) {\n                cur = node.parent;\n            }\n            \n            var xvars = copy(vars);\n            xvars[node.name] = val;\n            \n            var res = evaluate(cur, xvars);\n            if (res !== undefined) {\n                updates.push({\n                    start: cur.start,\n                    offset: cur.end - cur.start,\n                    stream: isStream(res) ? wrapStream(res) : st(String(res))\n                });\n            }\n        }\n        else {\n            output.emit('error', new Error(\n                'unsupported type for static module: ' + node.parent.type\n                + '\\nat expression:\\n\\n  ' + unparse(node.parent) + '\\n'\n            ));\n        }\n    }\n}\n\nfunction isRequire (node) {\n    var c = node.callee;\n    return c\n        && node.type === 'CallExpression'\n        && c.type === 'Identifier'\n        && c.name === 'require'\n    ;\n}\n\nfunction isStream (s) {\n    return s && typeof s === 'object' && typeof s.pipe === 'function';\n}\n\nfunction wrapStream (s) {\n    if (typeof s.read === 'function') return s\n    else return (new Readable).wrap(s)\n}\n\nfunction isStaticProperty(node) {\n    return node.type === 'Identifier' || node.type === 'Literal';\n}\n\nfunction resolveProperty(node) {\n    return node.type === 'Identifier' ? node.name : node.value;\n}\n\nfunction st (msg) {\n    var r = new Readable;\n    r._read = function () {};\n    if (msg != null) r.push(msg);\n    r.push(null);\n    return r;\n}\n"]}