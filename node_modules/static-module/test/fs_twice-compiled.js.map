{"version":3,"sources":["fs_twice.js"],"names":[],"mappings":"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","file":"fs_twice-compiled.js","sourcesContent":["var staticModule = require('../');\nvar test = require('tape');\nvar concat = require('concat-stream');\nvar quote = require('quote-stream');\nvar through = require('through2');\nvar fs = require('fs');\nvar path = require('path');\n\ntest('fs.readFileSync twice', function (t) {\n    var expected = [ 'EXTERMINATE\\n', 'beep boop\\n' ];\n    t.plan(expected.length + 1);\n    var sm = staticModule({\n        fs: { readFileSync: readFileSync }\n    }, { vars: { __dirname: __dirname + '/fs_twice' } });\n    readStream('html.js').pipe(sm).pipe(concat(function (body) {\n        t.equal(body.toString('utf8'),\n            'var a = \"EXTERMINATE\\\\n\";\\n'\n            + 'var b = \"beep boop\\\\n\";\\n'\n            + 'console.log(a);\\n'\n            + 'console.log(b);\\n'\n        );\n        Function(['console'],body)({ log: log });\n        function log (msg) { t.equal(msg, expected.shift()) }\n    }));\n});\n\ntest('fs.readFileSync twice in vars', function (t) {\n    var expected = [ 'EXTERMINATE\\n', 'beep boop\\n' ];\n    t.plan(expected.length + 1);\n    var sm = staticModule({\n        fs: { readFileSync: readFileSync }\n    }, { vars: { __dirname: __dirname + '/fs_twice' } });\n    readStream('vars.js').pipe(sm).pipe(concat(function (body) {\n        t.equal(body.toString('utf8').trim(),\n            'var a = \"EXTERMINATE\\\\n\",\\n'\n            + '    b = \"beep boop\\\\n\";\\n'\n            + 'console.log(a);\\n'\n            + 'console.log(b);'\n        );\n        Function(['console'],body)({ log: log });\n        function log (msg) { t.equal(msg, expected.shift()) }\n    }));\n});\n\ntest('fs.readFileSync 4x', function (t) {\n    var expected = [\n        'EXTERMINATE\\n', 'beep boop\\n', 'EXTERMINATE\\n', 'beep boop\\n'\n    ];\n    t.plan(expected.length + 1);\n    var sm = staticModule({\n        fs: { readFileSync: readFileSync }\n    }, { vars: { __dirname: __dirname + '/fs_twice' } });\n    readStream('4x.js').pipe(sm).pipe(concat(function (body) {\n        t.equal(body.toString('utf8').trim(),\n            'var a = \"EXTERMINATE\\\\n\";\\n'\n            + 'var b = \"beep boop\\\\n\";\\n'\n            + 'var c = \"EXTERMINATE\\\\n\";\\n'\n            + 'var d = \"beep boop\\\\n\";\\n'\n            + 'console.log(a);\\n'\n            + 'console.log(b);\\n'\n            + 'console.log(c);\\n'\n            + 'console.log(d);'\n        );\n        Function(['console'],body)({ log: log });\n        function log (msg) { t.equal(msg, expected.shift()) }\n    }));\n});\n\nfunction readStream (file) {\n    return fs.createReadStream(path.join(__dirname, 'fs_twice', file));\n}\n\nfunction readFile (file, cb) {\n    var stream = through(write, end);\n    stream.push('process.nextTick(function(){(' + cb + ')(null,');\n    return fs.createReadStream(file).pipe(quote()).pipe(stream);\n    \n    function write (buf, enc, next) { this.push(buf); next() }\n    function end (next) { this.push(')})'); this.push(null); next() }\n}\n\nfunction readFileSync (file, opts) {\n    return fs.createReadStream(file).pipe(quote());\n}\n"]}